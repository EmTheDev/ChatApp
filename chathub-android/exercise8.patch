From 8d06460e9b0450192c4b38755c5ba844dd8bfd16 Mon Sep 17 00:00:00 2001
From: Emil Navarro Santos <ensantos@mail.sfsu.edu>
Date: Wed, 2 Nov 2016 16:47:40 -0700
Subject: [PATCH] exercise8-camera

---
 app/src/main/AndroidManifest.xml                   |  3 +
 .../csc780/chathub/ui/ImageDialogFragment.java     | 85 ++++++++++++++++++++++
 .../edu/sfsu/csc780/chathub/ui/MainActivity.java   | 74 ++++++++++++++++++-
 .../edu/sfsu/csc780/chathub/ui/MessageUtil.java    |  7 +-
 .../main/res/drawable/ic_camera_alt_black_24px.xml | 12 +++
 app/src/main/res/layout/activity_main.xml          |  9 +++
 app/src/main/res/layout/image_dialog_layout.xml    | 17 +++++
 7 files changed, 201 insertions(+), 6 deletions(-)
 create mode 100644 app/src/main/java/edu/sfsu/csc780/chathub/ui/ImageDialogFragment.java
 create mode 100644 app/src/main/res/drawable/ic_camera_alt_black_24px.xml
 create mode 100644 app/src/main/res/layout/image_dialog_layout.xml

diff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml
index 15a7bac..3ac8506 100644
--- a/app/src/main/AndroidManifest.xml
+++ b/app/src/main/AndroidManifest.xml
@@ -1,6 +1,9 @@
 <?xml version="1.0" encoding="utf-8"?>
 <manifest xmlns:android="http://schemas.android.com/apk/res/android"
+
+
     package="edu.sfsu.csc780.chathub">
+    <uses-feature android:name="android.hardware.camera" android:required="true" />
     <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/>
     <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/>
     <application
diff --git a/app/src/main/java/edu/sfsu/csc780/chathub/ui/ImageDialogFragment.java b/app/src/main/java/edu/sfsu/csc780/chathub/ui/ImageDialogFragment.java
new file mode 100644
index 0000000..f13932d
--- /dev/null
+++ b/app/src/main/java/edu/sfsu/csc780/chathub/ui/ImageDialogFragment.java
@@ -0,0 +1,85 @@
+package edu.sfsu.csc780.chathub.ui;
+
+import android.app.AlertDialog;
+import android.app.Dialog;
+import android.graphics.Bitmap;
+import android.graphics.Color;
+import android.graphics.Point;
+import android.graphics.drawable.ColorDrawable;
+import android.os.Bundle;
+import android.support.v4.app.DialogFragment;
+import android.view.Display;
+import android.view.View;
+import android.widget.FrameLayout;
+import android.widget.ImageView;
+import android.widget.LinearLayout;
+
+import edu.sfsu.csc780.chathub.R;
+
+/**
+ * Created by emilsantos on 11/2/16.
+ */
+
+
+
+public class ImageDialogFragment extends DialogFragment {
+    private static final String PHOTO_BITMAP = "photobitmap";
+    private int SIDE_MARGIN = 0;
+    private static Bitmap mPhotoBitmap;
+    private int mScaledWidth;
+    private int mScaledHeight;
+    private ImageView imageView;
+
+
+
+    static ImageDialogFragment newInstance(Bitmap bitmap) {
+        ImageDialogFragment f = new ImageDialogFragment();
+        Bundle args = new Bundle();
+        args.putParcelable(PHOTO_BITMAP, bitmap);
+        f.setArguments(args);
+        return f;
+    }
+
+    @Override
+
+    public void onCreate(Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+        mPhotoBitmap = getArguments().getParcelable(PHOTO_BITMAP);
+        int imageWidth = mPhotoBitmap.getWidth();
+        int imageHeight = mPhotoBitmap.getHeight();
+        Display display = getActivity().getWindowManager().getDefaultDisplay();
+        Point size = new Point();
+        display.getSize(size);
+        int width = size.x;
+        mScaledWidth = (int) ((double) width - SIDE_MARGIN);
+        mScaledHeight = (int) ((double) imageHeight / (double) imageWidth * mScaledWidth);
+    }
+
+    @Override
+
+    public Dialog onCreateDialog(Bundle savedInstanceState) {
+        AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());
+        View view = getActivity().getLayoutInflater().inflate(R.layout.image_dialog_layout, null);
+
+//TODO: 1.get the photoImageView from the root view
+        imageView = (ImageView) view.findViewById(R.id.photoImageView);
+
+//TODO: 2.set layout parameters of photoImageView to the dimensions that were set in...
+        FrameLayout.LayoutParams params = (FrameLayout.LayoutParams) imageView.getLayoutParams();
+        params.width = mScaledWidth;
+        params.height = mScaledHeight;
+        imageView.setLayoutParams(params);
+
+//TODO: ...the constructor
+        builder.setView(view);
+
+//TODO: 3. set ImageBitmap of photoImageView to the bitmap from the constructor argument
+        imageView.setImageBitmap(mPhotoBitmap);
+
+        final Dialog dialog = builder.create();
+        dialog.getWindow().setBackgroundDrawable(
+                new ColorDrawable(Color.TRANSPARENT));
+        dialog.show();
+        return dialog;
+    }
+}
diff --git a/app/src/main/java/edu/sfsu/csc780/chathub/ui/MainActivity.java b/app/src/main/java/edu/sfsu/csc780/chathub/ui/MainActivity.java
index 2014a6d..de4187a 100644
--- a/app/src/main/java/edu/sfsu/csc780/chathub/ui/MainActivity.java
+++ b/app/src/main/java/edu/sfsu/csc780/chathub/ui/MainActivity.java
@@ -27,6 +27,8 @@ import android.preference.PreferenceManager;
 import android.provider.MediaStore;
 import android.support.annotation.NonNull;
 import android.support.design.widget.FloatingActionButton;
+import android.support.v4.app.DialogFragment;
+import android.support.v4.app.FragmentTransaction;
 import android.support.v4.app.LoaderManager;
 import android.support.v4.content.Loader;
 import android.support.v7.app.AppCompatActivity;
@@ -42,9 +44,11 @@ import android.view.MenuItem;
 import android.view.View;
 import android.widget.EditText;
 import android.widget.ImageButton;
+import android.widget.ImageView;
 import android.widget.ProgressBar;
 import android.widget.Toast;
 
+import com.bumptech.glide.load.resource.bitmap.GlideBitmapDrawable;
 import com.firebase.ui.database.FirebaseRecyclerAdapter;
 import com.google.android.gms.auth.api.Auth;
 import com.google.android.gms.common.ConnectionResult;
@@ -66,6 +70,8 @@ import java.util.Date;
 import edu.sfsu.csc780.chathub.R;
 import edu.sfsu.csc780.chathub.model.ChatMessage;
 
+import static edu.sfsu.csc780.chathub.R.id.cameraButton;
+
 public class MainActivity extends AppCompatActivity
         implements GoogleApiClient.OnConnectionFailedListener,
         MessageUtil.MessageLoadListener {
@@ -73,6 +79,7 @@ public class MainActivity extends AppCompatActivity
     private static final String TAG = "MainActivity";
     public static final String MESSAGES_CHILD = "messages";
     private static final int REQUEST_INVITE = 1;
+    public static final int REQUEST_TAKE_PHOTO = 5;
     public static final int REQUEST_PREFERENCES = 2;
     public static final int MSG_LENGTH_LIMIT = 64;
     private static final double MAX_LINEAR_DIMENSION = 500.0;
@@ -98,9 +105,36 @@ public class MainActivity extends AppCompatActivity
     private ImageButton mImageButton;
     private int mSavedTheme;
     private ImageButton mLocationButton;
+    private ImageButton mCameraButton;
+
+    private View.OnClickListener mImageClickListener = new View.OnClickListener() {
+
+        @Override
+        public void onClick(View v) {
+            ImageView photoView = (ImageView) v.findViewById(R.id.messageImageView);
+            // Only show the larger view in dialog if there's a image for the message
+            if (photoView.getVisibility() == View.VISIBLE) {
+                Bitmap bitmap = ((GlideBitmapDrawable) photoView.getDrawable()).getBitmap();
+                showPhotoDialog(ImageDialogFragment.newInstance(bitmap));
+            }
+        }
+    };
+
+    void showPhotoDialog(DialogFragment dialogFragment) {
+    // DialogFragment.show() will take care of adding the fragment
+    // in a transaction. We also want to remove any currently showing
+    // dialog, so make our own transaction and take care of that here.
+        FragmentTransaction ft = getSupportFragmentManager().beginTransaction();
+        android.support.v4.app.Fragment prev =
+                getSupportFragmentManager().findFragmentByTag("dialog");
+        if (prev != null) { ft.remove(prev); }
+        ft.addToBackStack(null);
+        dialogFragment.show(ft, "dialog");
+    }
 
     @Override
     protected void onCreate(Bundle savedInstanceState) {
+
         super.onCreate(savedInstanceState);
         DesignUtils.applyColorfulTheme(this);
         setContentView(R.layout.activity_main);
@@ -136,11 +170,11 @@ public class MainActivity extends AppCompatActivity
         mFirebaseAdapter = MessageUtil.getFirebaseAdapter(this,
                 this,  /* MessageLoadListener */
                 mLinearLayoutManager,
-                mMessageRecyclerView);
-        mMessageRecyclerView.setAdapter(mFirebaseAdapter);
+                mMessageRecyclerView,
+                mImageClickListener);
 
+        mMessageRecyclerView.setAdapter(mFirebaseAdapter);
         mProgressBar.setVisibility(ProgressBar.INVISIBLE);
-
         mMessageEditText = (EditText) findViewById(R.id.messageEditText);
         mMessageEditText.setFilters(new InputFilter[]{new InputFilter.LengthFilter(MSG_LENGTH_LIMIT)});
         mMessageEditText.addTextChangedListener(new TextWatcher() {
@@ -161,7 +195,7 @@ public class MainActivity extends AppCompatActivity
             public void afterTextChanged(Editable editable) {
             }
         });
-
+        
         mSendButton = (FloatingActionButton) findViewById(R.id.sendButton);
         mSendButton.setOnClickListener(new View.OnClickListener() {
             @Override
@@ -177,7 +211,24 @@ public class MainActivity extends AppCompatActivity
             }
         });
 
+        mCameraButton = (ImageButton) findViewById(R.id.cameraButton);
+        mCameraButton.setOnClickListener(new View.OnClickListener() {
+
+
+            @Override
+            public void onClick(View v) {
+                dispatchTakePhotoIntent();
+            }
+
+            private void dispatchTakePhotoIntent() {
+                Intent imageCapture = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);
+                if(imageCapture.resolveActivity(getPackageManager()) != null){
+                    startActivityForResult(imageCapture, REQUEST_TAKE_PHOTO);
+                }
 
+            }
+        });
+        
         mImageButton = (ImageButton) findViewById(R.id.shareImageButton);
         mImageButton.setOnClickListener(new View.OnClickListener() {
             @Override
@@ -193,7 +244,10 @@ public class MainActivity extends AppCompatActivity
                 loadMap();
             }
         });
+
+
     }
+    
 
     @Override
     public void onStart() {
@@ -311,6 +365,18 @@ public class MainActivity extends AppCompatActivity
                 this.recreate();
             }
         }
+        if (requestCode == REQUEST_TAKE_PHOTO && resultCode == Activity.RESULT_OK){
+            if (data != null) {
+                Uri uri = data.getData();
+                Bundle extras = data.getExtras();
+                Bitmap imageBitMap = (Bitmap) extras.get("data");
+
+                if (imageBitMap != null) {
+                    uri = savePhotoImage(imageBitMap);
+                    createImageMessage(uri);
+                }
+            }
+        }
     }
 
     private void createImageMessage(Uri uri) {
diff --git a/app/src/main/java/edu/sfsu/csc780/chathub/ui/MessageUtil.java b/app/src/main/java/edu/sfsu/csc780/chathub/ui/MessageUtil.java
index 56f1adc..2f18ac0 100644
--- a/app/src/main/java/edu/sfsu/csc780/chathub/ui/MessageUtil.java
+++ b/app/src/main/java/edu/sfsu/csc780/chathub/ui/MessageUtil.java
@@ -48,6 +48,7 @@ public class MessageUtil {
     }
 
     public static class MessageViewHolder extends RecyclerView.ViewHolder {
+        public static View.OnClickListener sMessageClickListener;
         public TextView messageTextView;
         public ImageView messageImageView;
         public TextView messengerTextView;
@@ -56,6 +57,7 @@ public class MessageUtil {
         public View messageLayout;
         public MessageViewHolder(View v) {
             super(v);
+            v.setOnClickListener(sMessageClickListener);
             messageTextView = (TextView) itemView.findViewById(R.id.messageTextView);
             messengerTextView = (TextView) itemView.findViewById(R.id.messengerTextView);
             messengerImageView = (CircleImageView) itemView.findViewById(R.id.messengerImageView);
@@ -68,7 +70,8 @@ public class MessageUtil {
     public static FirebaseRecyclerAdapter getFirebaseAdapter(final Activity activity,
                                                              MessageLoadListener listener,
                                                              final LinearLayoutManager linearManager,
-                                                             final RecyclerView recyclerView) {
+                                                             final RecyclerView recyclerView,
+                                                             final View.OnClickListener OnClickListener) {
         final SharedPreferences preferences =
                 PreferenceManager.getDefaultSharedPreferences(activity);
         sAdapterListener = listener;
@@ -81,6 +84,7 @@ public class MessageUtil {
             @Override
             protected void populateViewHolder(final MessageViewHolder viewHolder,
                                               ChatMessage chatMessage, int position) {
+                viewHolder.sMessageClickListener = OnClickListener;
                 sAdapterListener.onLoadComplete();
                 viewHolder.messageTextView.setText(chatMessage.getText());
                 viewHolder.messengerTextView.setText(chatMessage.getName());
@@ -152,7 +156,6 @@ public class MessageUtil {
                             timestamp));
                     viewHolder.timestampTextView.setVisibility(View.VISIBLE);
                 }
-
             }
         };
 
diff --git a/app/src/main/res/drawable/ic_camera_alt_black_24px.xml b/app/src/main/res/drawable/ic_camera_alt_black_24px.xml
new file mode 100644
index 0000000..d983072
--- /dev/null
+++ b/app/src/main/res/drawable/ic_camera_alt_black_24px.xml
@@ -0,0 +1,12 @@
+<vector xmlns:android="http://schemas.android.com/apk/res/android"
+        android:width="24dp"
+        android:height="24dp"
+        android:viewportWidth="24.0"
+        android:viewportHeight="24.0">
+    <path
+        android:pathData="M12,12m-3.2,0a3.2,3.2 0,1 1,6.4 0a3.2,3.2 0,1 1,-6.4 0"
+        android:fillColor="#000000"/>
+    <path
+        android:pathData="M9,2L7.17,4L4,4c-1.1,0 -2,0.9 -2,2v12c0,1.1 0.9,2 2,2h16c1.1,0 2,-0.9 2,-2L22,6c0,-1.1 -0.9,-2 -2,-2h-3.17L15,2L9,2zM12,17c-2.76,0 -5,-2.24 -5,-5s2.24,-5 5,-5 5,2.24 5,5 -2.24,5 -5,5z"
+        android:fillColor="#000000"/>
+</vector>
diff --git a/app/src/main/res/layout/activity_main.xml b/app/src/main/res/layout/activity_main.xml
index df414cf..60eb697 100644
--- a/app/src/main/res/layout/activity_main.xml
+++ b/app/src/main/res/layout/activity_main.xml
@@ -42,6 +42,15 @@
                 android:layout_weight="1"/>
 
             <ImageButton
+                android:id="@+id/cameraButton"
+                android:src="@drawable/ic_camera_alt_black_24px"
+                android:background="@drawable/button_ripple"
+                android:layout_gravity="center_vertical"
+                android:padding="16dp"
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content"/>
+
+            <ImageButton
                 android:id="@+id/locationButton"
                 android:src="@drawable/ic_my_location_black_24px"
                 android:background="@drawable/button_ripple"
diff --git a/app/src/main/res/layout/image_dialog_layout.xml b/app/src/main/res/layout/image_dialog_layout.xml
new file mode 100644
index 0000000..fc637be
--- /dev/null
+++ b/app/src/main/res/layout/image_dialog_layout.xml
@@ -0,0 +1,17 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent"
+    xmlns:tools="http://schemas.android.com/tools">
+
+    <ImageView
+        android:layout_width="240dp"
+        android:layout_height="240dp"
+        android:padding="10dp"
+        android:background="#ffffff"
+        android:id="@+id/photoImageView"
+        tools:src="@drawable/common_ic_googleplayservices"
+        android:scaleType="fitCenter"
+        android:layout_gravity="center"/>
+</FrameLayout>
\ No newline at end of file
-- 
2.8.4 (Apple Git-73)

